#!/usr/bin/env bash
#####################################################################################################################################################################################################
# Project:       Juniper
# Sub-Project:   JuniperCascor
# Application:   juniper_cascor
# Purpose:       Juniper Project Cascade Correlation Neural Network
#
# Author:        Paul Calnon
# Version:       1.0.0
# File Name:     get_todo_comments.bash
# File Path:     <Project>/<Sub-Project>/<Application>/util/
#
# Date Created:  2025-12-03
# Last Modified: 2026-01-12
#
# License:       MIT License
# Copyright:     Copyright (c) 2024,2025,2026 Paul Calnon
#
# Description:
#     This script collects Descriptions associated with all TODO Comments in the Juniper python project code base
#
#####################################################################################################################################################################################################
# Notes:
#
#####################################################################################################################################################################################################
# References:
#
#####################################################################################################################################################################################################
# TODO :
#
#####################################################################################################################################################################################################
# COMPLETED:
#
#####################################################################################################################################################################################################


#####################################################################################################################################################################################################
# Source script config file
#####################################################################################################################################################################################################
set -o functrace
# shellcheck disable=SC2155
export PARENT_PATH_PARAM="$(realpath "${BASH_SOURCE[0]}")" && INIT_CONF="$(dirname "$(dirname "${PARENT_PATH_PARAM}")")/conf/init.conf"
# shellcheck disable=SC2015,SC1090
[[ -f "${INIT_CONF}" ]] && source "${INIT_CONF}" || { echo "Init Config File Not Found. Unable to Continue."; exit 1; }


#####################################################################################################################################################################################################
# Process Script's Command Line Argument(s)
#     usage 1 "Error: Invalid command line params: \"${@}\"\n"
#####################################################################################################################################################################################################
log_trace "Process Script's Command Line Argument(s)"
if [[ "$1" != "" ]]; then
    [[ "$1" == "${HELP_SHORT}" || "$1" == "${HELP_LONG}" ]] && usage $(( TRUE )) || SEARCH_TERM="$1"
else
    # shellcheck disable=SC2015
    [[ "${DEBUG}" == "${TRUE}" ]] && SEARCH_TERM="${SEARCH_TERM_DEFAULT}" || usage
fi


#####################################################################################################################################################################################################
# Sanitize Inputs
#####################################################################################################################################################################################################
log_trace "Sanitize Inputs"
DASHES=$(echo "${SEARCH_TERM}" | grep -e '^-.*')
if [[ ${DASHES} != "" ]]; then
    SEARCH_TERM="\\${SEARCH_TERM}"
    log_debug  "Sanitized SEARCH_TERM Input: ${SEARCH_TERM}"
fi


#####################################################################################################################################################################################################
# Search for a specific TODO reference in source code
#####################################################################################################################################################################################################
log_trace "Search for a specific TODO reference in source code"
while read -r i; do
    SOURCE_FILE=$(echo "${i}" | grep "\.${SRC_FILE_SUFFIX}\$")
    [[ "${SOURCE_FILE}" != "" ]] && SOURCE_FILE=$(echo "${SOURCE_FILE}" | grep -v "${INIT_PYTHON_FILE}")
	if [[ "${SOURCE_FILE}" != "" ]]; then
        if [[ -f "${SOURCE_FILE}" ]]; then
            FOUND=$(cat "${SOURCE_FILE}" | grep "${SEARCH_TERM}")
            if [[ "${FOUND}" != "" ]]; then
                FOUND_COUNT="$((FOUND_COUNT + 1))"
                if [[ "${DEBUG}" == "${TRUE}" || "${FULL_OUTPUT}" == "${TRUE}" ]]; then
                    echo -ne "${SOURCE_FILE}\n${FOUND}\n\n"
                fi
            else
                DONE_COUNT="$((DONE_COUNT + 1))"
                if [[ "${FULL_OUTPUT}" == "${TRUE}" && "${DEBUG}" == "${TRUE}" ]]; then
                    echo -ne "${SOURCE_FILE}\n\tNot Found: **********************\n\n"
                fi
            fi
        fi
    fi
done <<< "$(find "${SRC_DIR}" -type f)"


#####################################################################################################################################################################################################
# Display Results
#####################################################################################################################################################################################################
echo "Search Term: \"${SEARCH_TERM}\""
echo "Found in Files: ${FOUND_COUNT}"
echo "Files Complete: ${DONE_COUNT}"

return $(( TRUE ))
