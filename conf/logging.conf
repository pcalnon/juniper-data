#!/usr/bin/env bash
#####################################################################################################################################################################################################
# Project:       Juniper
# Sub-Project:   JuniperCanopy
# Application:   juniper_canopy
# Purpose:       Monitoring and Diagnostic Frontend for Cascade Correlation Neural Network
#
# Author:        Paul Calnon
# Version:       1.0.0
# File Name:     logging.conf
# File Path:     <Project>/<Sub-Project>/<Application>/conf/
#
# Date:          2025-11-21
# Last Modified: 2025-12-19
#
# License:       MIT License
# Copyright:     Copyright (c) 2024,2025,2026 Paul Calnon
#
# Description:
#     This script is used to perform leveled logging for the JuniperCanopy util scripts.
#
#####################################################################################################################################################################################################
# Notes:
#     This script functions as a config file and is used to perform leveled logging for the Close scripts.
#     The supported logging levels are DEBUG, INFO, WARNING, ERROR, and CRITICAL.
#
#     Warning:
#         This config file is sourced by the config files for the api_request.bash and launch_close.bash scripts.
#
#     Logging Levels:
#         - The DEBUG level is only logged if the DEBUG environment variable is set to TRUE, returns 0
#         - The INFO level is always logged, returns 0
#         - The WARNING level is always logged, returns 0
#         - The ERROR level is always logged and the script returns 1
#         - The CRITICAL level is always logged and the script exits with an error code
#
#####################################################################################################################################################################################################
# References:
#
#####################################################################################################################################################################################################
# TODO :
#
#####################################################################################################################################################################################################
# COMPLETED:
#
#####################################################################################################################################################################################################


#####################################################################################################################################################################################################
# Define General Logging Constants
#####################################################################################################################################################################################################
TRUE="0"
FALSE="1"

DEBUG="${TRUE}"
# DEBUG="${FALSE}"

TAB_SIZE="4"


#####################################################################################################################################################################################################
# Check if this config file has already been sourced.  Only Source this conf file Once
#####################################################################################################################################################################################################
if [[ "${JUNIPER_LOGGING_CONF_SOURCED}" != "${TRUE}" ]]; then
    export JUNIPER_LOGGING_CONF_SOURCED="${TRUE}"
else
    log_warning "logging.conf already sourced.  Skipping re-source."
    return "${TRUE}"
fi


#####################################################################################################################################################################################################
# Setup Environment for logging line numbers and function names
#####################################################################################################################################################################################################
export SCRIPT_NAME_ID="1"
export LINE_NO_ID="0"
export FUNC_NAME_ID="1"


#####################################################################################################################################################################################################
# Define Log File Constants
#####################################################################################################################################################################################################
LOG_FILE_NAME="juniper_canopy_util.log"
LOG_FILE_PATH="$(dirname "$(realpath "${BASH_SOURCE[0]}")")"
export LOG_FILE="${LOG_FILE_PATH}/${LOG_FILE_NAME}"


#####################################################################################################################################################################################################
# Clear logs only if in Debug mode
#####################################################################################################################################################################################################
if [[ "${TRUNCATED_LOGS}" != "${TRUE}" ]]; then
    [[ "${DEBUG}" == "${TRUE}" ]] && cat /dev/null > "${LOG_FILE}"
    export TRUNCATED_LOGS="${TRUE}"
fi


#####################################################################################################################################################################################################
# Define Constants for Terminal Text Colors
#####################################################################################################################################################################################################
export BLACK_DARK="\033[2;30m"           # Black
export BLACK="\033[0;30m"
export BLACK_BRIGHT="\033[1;30m"
export BLACK_BOLD_DARK="\033[2;90m"
export BLACK_BOLD="\033[0;90m"
export BLACK_BOLD_BRIGHT="\033[1;90m"
export RED_DARK="\033[2;31m"             # Red
export RED="\033[0;31m"
export RED_BRIGHT="\033[1;31m"
export RED_BOLD_DARK="\033[2;91m"
export RED_BOLD="\033[0;91m"
export RED_BOLD_BRIGHT="\033[1;91m"
export GREEN_DARK="\033[2;32m"           # Green
export GREEN="\033[0;32m"
export GREEN_BRIGHT="\033[1;32m"
export GREEN_BOLD_DARK="\033[2;92m"
export GREEN_BOLD="\033[0;92m"
export GREEN_BOLD_BRIGHT="\033[1;92m"
export YELLOW_DARK="\033[2;33m"          # Yellow
export YELLOW="\033[0;33m"
export YELLOW_BRIGHT="\033[1;33m"
export YELLOW_BOLD_DARK="\033[2;93m"
export YELLOW_BOLD="\033[0;93m"
export YELLOW_BOLD_BRIGHT="\033[1;93m"
export BLUE_DARK="\033[2;34m"            # Blue
export BLUE="\033[0;34m"
export BLUE_BRIGHT="\033[1;34m"
export BLUE_BOLD_DARK="\033[2;94m"
export BLUE_BOLD="\033[0;94m"
export BLUE_BOLD_BRIGHT="\033[1;94m"
export MAGENTA_DARK="\033[2;35m"         # Magenta
export MAGENTA="\033[0;35m"
export MAGENTA_BRIGHT="\033[1;35m"
export MAGENTA_BOLD_DARK="\033[2;95m"
export MAGENTA_BOLD="\033[0;95m"
export MAGENTA_BOLD_BRIGHT="\033[1;95m"
export CYAN_DARK="\033[2;36m"            # Cyan
export CYAN="\033[0;36m"
export CYAN_BRIGHT="\033[1;36m"
export CYAN_BOLD_DARK="\033[2;96m"
export CYAN_BOLD="\033[0;96m"
export CYAN_BOLD_BRIGHT="\033[1;96m"
export WHITE_DARK="\033[2;37m"           # White
export WHITE="\033[0;37m"
export WHITE_BRIGHT="\033[1;37m"
export WHITE_BOLD_DARK="\033[2;97m"
export WHITE_BOLD="\033[0;97m"
export WHITE_BOLD_BRIGHT="\033[1;97m"
export RESET="\033[0m"                   # Reset


#####################################################################################################################################################################################################
# Define Constants for Logging Level Colors
#####################################################################################################################################################################################################
export COLOR_DEBUG="${BLUE_BRIGHT}"
export COLOR_INFO="${GREEN}"
export COLOR_WARNING="${YELLOW_BOLD}"
export COLOR_ERROR="${RED}"
export COLOR_CRITICAL="${RED_BRIGHT}"


#####################################################################################################################################################################################################
# Define Label Constants for Logging Levels
#####################################################################################################################################################################################################
declare -a LOG_LEVELS=("[DEBUG]" "[INFO]" "[WARNING]" "[ERROR]" "[CRITICAL]")

DEBUG_ID=0
INFO_ID=1
WARNING_ID=2
ERROR_ID=3
CRITICAL_ID=4


#####################################################################################################################################################################################################
# # Define Logging Helper functions
#####################################################################################################################################################################################################
function logger() {
    printf "%b%-21s %-28s %-21s %-11s %s%b\n" "$5" "($(date +%F_%T))" "$1:($2):" "$3:" "${LOG_LEVELS[$4]}" "$6" "${RESET}" | tee -a "${LOG_FILE}" 2>&1
    return "${TRUE}"
}


#####################################################################################################################################################################################################
# Define logging level functions
#####################################################################################################################################################################################################
function log_debug() {
    [[ "${DEBUG}" != "${TRUE}" ]] && return "${FALSE}"
    local CALLING_SCRIPT="$(basename "$(realpath ${BASH_SOURCE[${SCRIPT_NAME_ID}]})")"
    local CALLING_LINE="${BASH_LINENO[${LINE_NO_ID}]}"
    local CALLING_FUNC="${FUNCNAME[${FUNC_NAME_ID}]}"
    local COLOR="${COLOR_DEBUG}"
    logger "${CALLING_SCRIPT}" "${CALLING_LINE}" "${CALLING_FUNC}" "${DEBUG_ID}" "${COLOR}" "$1"
    return "${TRUE}"
}

function log_info() {
    local CALLING_SCRIPT="$(basename "$(realpath ${BASH_SOURCE[${SCRIPT_NAME_ID}]})")"
    local CALLING_LINE="${BASH_LINENO[${LINE_NO_ID}]}"
    local CALLING_FUNC="${FUNCNAME[${FUNC_NAME_ID}]}"
    local COLOR="${COLOR_INFO}"
    logger "${CALLING_SCRIPT}" "${CALLING_LINE}" "${CALLING_FUNC}" "${INFO_ID}" "${COLOR}" "$1"
    return "${TRUE}"
}

function log_warning() {
    local CALLING_SCRIPT="$(basename "$(realpath ${BASH_SOURCE[${SCRIPT_NAME_ID}]})")"
    local CALLING_LINE="${BASH_LINENO[${LINE_NO_ID}]}"
    local CALLING_FUNC="${FUNCNAME[${FUNC_NAME_ID}]}"
    local COLOR="${COLOR_WARNING}"
    logger "${CALLING_SCRIPT}" "${CALLING_LINE}" "${CALLING_FUNC}" "${WARNING_ID}" "${COLOR}" "$1"
    return "${TRUE}"
}

function log_error() {
    local CALLING_SCRIPT="$(basename "$(realpath ${BASH_SOURCE[${SCRIPT_NAME_ID}]})")"
    local CALLING_LINE="${BASH_LINENO[${LINE_NO_ID}]}"
    local CALLING_FUNC="${FUNCNAME[${FUNC_NAME_ID}]}"
    local COLOR="${COLOR_ERROR}"
    logger "${CALLING_SCRIPT}" "${CALLING_LINE}" "${CALLING_FUNC}" "${ERROR_ID}" "${COLOR}" "$1"
    return "${FALSE}"
}

function log_critical() {
    local CALLING_SCRIPT="$(basename "$(realpath ${BASH_SOURCE[${SCRIPT_NAME_ID}]})")"
    local CALLING_LINE="${BASH_LINENO[${LINE_NO_ID}]}"
    local CALLING_FUNC="${FUNCNAME[${FUNC_NAME_ID}]}"
    local COLOR="${COLOR_CRITICAL}"
    logger "${CALLING_SCRIPT}" "${CALLING_LINE}" "${CALLING_FUNC}" "${CRITICAL_ID}" "${COLOR}" "$1"
    set -e && exit "${FALSE}"
}


#####################################################################################################################################################################################################
# Set the tab size for the logging functions
#####################################################################################################################################################################################################
tabs "${TAB_SIZE}"


#####################################################################################################################################################################################################
# Export logging functions to calling script
#####################################################################################################################################################################################################
export -f log_debug
export -f log_info
export -f log_warning
export -f log_error
export -f log_critical

return "${TRUE}"
