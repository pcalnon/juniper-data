#!/usr/bin/env bash
#####################################################################################################################################################################################################
# Project:       Juniper
# Sub-Project:   JuniperCanopy
# Application:   juniper_canopy
# Purpose:       Monitoring and Diagnostic Frontend for Cascade Correlation Neural Network
#
# Author:        Paul Calnon
# Version:       1.0.0
# File Name:     config_fail.conf
# File Path:     <Project>/<Sub-Project>/<Application>/conf/
#
# Date:          2025-12-17
# Last Modified: 2025-12-19
#
# License:       MIT License
# Copyright:     Copyright (c) 2024,2025,2026 Paul Calnon
#
# Description:
#     This file defines a local, log_error function that can be used when the config process fails.
#     This local, log_error function matches the log message format used when project is properly configured.
#
#####################################################################################################################################################################################################
# Notes:
#
#####################################################################################################################################################################################################
# References:
#
#####################################################################################################################################################################################################
# TODO :
#
#####################################################################################################################################################################################################
# COMPLETED:
#
#####################################################################################################################################################################################################


#####################################################################################################################################################################################################
# Define Debug Constants
#####################################################################################################################################################################################################
export TRUE="0"
export FALSE="1"

export DEBUG="${TRUE}"
# export DEBUG="${FALSE}"


#####################################################################################################################################################################################################
# Check if this config file has already been sourced.  Only Source this conf file Once
#####################################################################################################################################################################################################
if [[ "${JUNIPER_LOGGING_CONF_SOURCED}" != "${TRUE}" ]]; then
    export JUNIPER_LOGGING_CONF_SOURCED="${TRUE}"
else
    log_warning "logging.conf already sourced.  Skipping re-source."
    return "${TRUE}"
fi


#####################################################################################################################################################################################################
# Define Top Level Script error log Function and required constants, Handle Failed Config file sourcing
#####################################################################################################################################################################################################
function log_critical() {
    SUCCESS="$1"; PARENT_PATH_PARAM="$2"; INIT_CONF="$3"; LINENO="$4"; LOG_FILE="$5"  # This, log file, is the only param that could be undefined, unless squirrels ate my pants.
    [[ "${LOG_FILE}" == "" ]] && LOG_FILE="../logs/$(basename "$(dirname "$(dirname "${PARENT_PATH_PARAM}")")")_$(date +%F_%T).log"
    [[ "${SUCCESS}" != "${TRUE}" ]] && { printf "%b%-21s %-28s %-21s %-11s %s%b\n" "\033[1;31m" "($(date +%F_%T))" "$(basename "${PARENT_PATH_PARAM}"):(${LINENO})" "main:" "[CRITICAL]" "Config load Failed: \"${INIT_CONF}\"" "\033[0m" | tee -a "${LOG_FILE}" 2>&1; set -e && exit "${FALSE}"; }
}

function log_error() {
    log_critical "$@"
}


#####################################################################################################################################################################################################
# Export critical logging and its error logging alias
#####################################################################################################################################################################################################
export -f log_critical
export -f log_error

return "${TRUE}"
