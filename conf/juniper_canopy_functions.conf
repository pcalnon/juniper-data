#!/usr/bin/env bash
#####################################################################################################################################################################################################
# Project:       Juniper
# Sub-Project:   JuniperCanopy
# Application:   juniper_canopy
# Purpose:       Monitoring and Diagnostic Frontend for Cascade Correlation Neural Network
#
# Author:        Paul Calnon
# Version:       0.1.4 (0.7.3)
# File Name:     juniper_canopy_functions.conf
# File Path:     <Project>/<Sub-Project>/<Application>/conf/
#
# Date:          2026-01-18
# Last Modified: 2026-01-28
#
# License:       MIT License
# Copyright:     Copyright (c) 2024,2025,2026 Paul Calnon
#
# Description:
#    This Script serves as the config file for the Juniper Project's juniper_canopy
#    Warning:  This Script / Config file is sourced by the try.bash script
#
#####################################################################################################################################################################################################
# Notes:
#     Warning:  This Config file is sourced by the try.bash script
#
#     The primary use case for this Script is to be sourced by the try.bash script.
#     However, this script can also be run directly from the command line for testing purposes.
#     When run directly from the command line, this script will output debug information based on the DEBUG constant defined within the script.
#     A convenience script, ~/Development/python/JuniperCanopy/juniper_canopy/conf/test_prototype_conf.bash, is provided for testing this config file.
#
#####################################################################################################################################################################################################
# References:
#
#####################################################################################################################################################################################################
# TODO :
#
#####################################################################################################################################################################################################
# COMPLETED:
#
#####################################################################################################################################################################################################


#####################################################################################################################################################################################################
# Check if this config file has already been sourced.  Only Source this conf file Once
#####################################################################################################################################################################################################
if [[ "${JUNIPER_CANOPY_FUNCTIONS_CONF_SOURCED}" != "${TRUE}" ]]; then
    JUNIPER_CANOPY_FUNCTIONS_CONF_SOURCED="${TRUE}"
else
    log_warning "juniper_canopy_functions.conf already sourced.  Skipping re-source."
    return $(( TRUE ))
fi


#####################################################################################################################################################################################################
# Define Script functions
#####################################################################################################################################################################################################
function set_language_path() {
    LANGUAGE="$1"    && log_debug "Language: \"${LANGUAGE}\""
    LANG_PATH="$2"   && log_debug "Lang Path: \"${LANG_PATH}\""
    MAJ_VER="$3"     && log_debug "Major Version: \"${MAJ_VER}\""
    MIN_VER="$4"     && log_debug "Minor Version: \"${MIN_VER}\""
    LANG_NAME="$5"   && log_debug "Language Name: \"${LANG_NAME}\""

    [[ "${LANG_NAME}" == "${LANGUAGE}" ]] && LANGUAGE="${LANG_NAME}${MAJ_VER}${MIN_VER}"
    LANGUAGE_ABS_PATH="${LANG_PATH}${PATH_DELIMITER}${LANGUAGE}"
    log_debug "Initial Language Name: ${LANGUAGE_NAME}"
    [[ "${LANGUAGE_NAME}" == "" ]] && LANGUAGE_NAME="${LANG_NAME}"
    log_debug "Final Language Name: ${LANGUAGE_NAME}"
    log_debug "Initial Language Path: ${LANGUAGE_PATH}"
    [[ "${LANGUAGE_PATH}" == "" ]] && LANGUAGE_PATH="${LANGUAGE_ABS_PATH}"
    log_debug "Final Language Path: ${LANGUAGE_PATH}"
    log_debug "Initial Language Vers: ${LANGUAGE_VERS}"
    [[ "${LANGUAGE_VERS}" == "" ]] && LANGUAGE_VERS="${MAJ_VER}${MIN_VER}"
    log_debug "Final Language Vers: ${LANGUAGE_VERS}"

    eval "export ${LANG_NAME^^}=\"${LANGUAGE_ABS_PATH}\""
}


function contains() {
    local ITEM="$1" && shift
    for ELEMENT in "${@}"; do
        if [[ "${ELEMENT}" == "${ITEM}" ]]; then
            return 0
        fi
    done
    return 1
}


function get_index() {
    local ITEM="$1" && shift
    log_verbose "Item: \"${ITEM}\""
    # Build LIST from the remaining arguments safely, preserving whitespace and glob characters
    # local LIST=("$*")
    # local LIST=("$*")
    local LIST=("$@")
    log_verbose "List: \"${LIST[*]}\""
    local NUM_ELEMENTS="${#LIST[@]}"
    log_verbose "Num Elements: ${NUM_ELEMENTS}"
    local INDEX=0

    # for ELEMENT in "${LIST[@]}"; do
    # for ELEMENT in ${LIST[*]}; do
    for ELEMENT in "${LIST[@]}"; do
        log_verbose "Element: \"${ELEMENT}\""
        if [[ "${ELEMENT}" == "${ITEM}" ]]; then
            # echo "${INDEX}"
            log_verbose "Index: ${INDEX}"
            # return 0
            break
        fi
        INDEX="$(( INDEX + 1 ))"
    done
    if (( INDEX >= NUM_ELEMENTS )); then
        INDEX="${NOT_FOUND}"
        log_verbose "Index: ${INDEX}"
        export LANGUAGE_INDEX="${INDEX}"
        return 1
    else
        log_verbose "Index: ${INDEX}"
        export LANGUAGE_INDEX="${INDEX}"
        return 0
    fi
}


#####################################################################################################################################################################################################
# Export functions
#####################################################################################################################################################################################################
export -f set_language_path
export -f contains
export -f get_index

return $(( TRUE ))
